/*! m4m v0.0.1 2016-03-18 */
"use strict";function AppsService(a,b,c,d){function e(a){function c(a){e.resolve(a)}function d(a){e.reject(a)}var e=b.defer();return k.login({provider:a.provider},a.credentials).$promise.then(c)["catch"](d),e.promise}function f(a,b){var e=a+"?access_token="+d.getItem("token",!0)+"&state="+encodeURIComponent(b);return c.location.assign(j+e)}function g(a){function c(a){e.resolve(a)}function d(a){e.reject(a)}var e=b.defer();return k.get({provider:a}).$promise.then(c)["catch"](d),e.promise}function h(a){var b;switch(a){case"nike":b="Nike+";break;default:b=a}return b.charAt(0).toUpperCase()+b.substr(1)}function i(a){function c(){e.resolve()}function d(){e.reject()}var e=b.defer();return k.getStatus({provider:a}).$promise.then(c)["catch"](d),e.promise}var j=c.location.origin+"/auth/provider/",k=a("/auth/:controller/:provider/:action",{},{get:{method:"GET",params:{controller:"apps"}},login:{method:"POST",params:{controller:"provider"}},getStatus:{method:"GET",params:{controller:"provider",action:"status"}}});return{credentialsLogin:e,oauthLogin:f,refreshApp:g,getReadableProvider:h,checkProviderStatus:i}}function m4mConnectAppsCredentials(){function a(a,b,c,d,e,f,g){function h(){"polar"===k.provider?(k.disableForm=!1,k.alerts=d.setAlert("info","ERROR.POLARNEEDAUTHORIZATION"),b.scrollTo(0,0)):e.broadcast(g.appsLoginSuccess)}function i(a){k.disableForm=!1,a.data.error&&(f.setValidity(k.appForm,"email","m4m-server",!1),f.setValidity(k.appForm,"password","m4m-server",!1),k.errors={provider:a.data.vars.provider,email:a.data.vars.email},k.alerts=d.setAlert("warning","ERROR."+a.data.error.toUpperCase()),b.scrollTo(0,0))}function j(a){k.appForm=a,k.disableForm=!0,a.$valid?("polar"===k.app.provider&&(k.app.credentials.password="polar"),c.credentialsLogin(k.app).then(h,i)):k.disableForm=!1}var k=this;k.readableProvider=c.getReadableProvider(k.provider),k.app={provider:k.provider,credentials:{}},k.appForm={},k.submit=j,k.closeAlert=d.closeAlert}return{restrict:"EA",scope:{provider:"=",urlParent:"@"},templateUrl:"src/directives/app-connect-credentials/app-connect-credentials.html",controller:a,controllerAs:"connectAppsCredentials",bindToController:!0}}function m4mConnectApp(){function a(a,b,c,d){function e(b,c,d){function e(){return AppsService.oauthLogin(b,d||h.stateUrl)}function f(){h.errors={provider:AppsService.getReadableProvider(b)},h.alerts=a.setAlert("warning","ERROR.API_NOT_READY")}return c?void AppsService.checkProviderStatus(b).then(e,f):AppsService.oauthLogin(b,h.stateUrl)}function f(a,b){function d(){return e(a,!1,h.stateUrl)}function f(){c.goToState(h.state,{provider:a})}b?AppsService.checkProviderStatus(a).then(d,f):c.goToState(h.state,{provider:a})}function g(){}var h=this;h.oauth=e,h.getCredApps=f,h.openFAQ=g}return{restrict:"EA",scope:{apps:"=",state:"@",stateUrl:"@"},templateUrl:"src/directives/app-connect/app-connect.html",controller:a,controllerAs:"connectApps",bindToController:!0}}angular.module("m4m.services",[]),angular.module("m4m.directives",[]),angular.module("m4m.services").service("m4mAppsService",AppsService),angular.module("m4m.directives").directive("m4mConnectAppsCredentials",m4mConnectAppsCredentials),angular.module("m4m.directives").directive("m4mConnectApp",m4mConnectApp),angular.module("m4m",["m4m.directives","m4m.services"]);